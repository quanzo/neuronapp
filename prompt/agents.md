# Agent - связь с LLM, определение специализации и возможностей

__Агент__ определяет параметры LLM, в которую агент оптравляет сообщения. Там конфигурируем размер контекста, системный промпт, использование векторного хранилища (Qdrant), embedding модель и т.п.

Язык программирования: php 8.1

Библиотеки:
* vendor/neuron-core/neuron-ai
* vendor/amphp/amp
* vendor/amphp/http-client

## Структура и файлы

* `src/classes/config/ConfigurationAgent.php` это класс, который представляет конфигурацию агента.
* `agents/neuron1.php` в этом файле представлен пример конфигурации агента в виде файла php. В комментариях расположены дополнительные возможные параметры

Агенты будем хранить в папке `agents/` что располагать будем в рабочей папке программы, которая определена константой `APP_WORK_DIR`. Имя файла - это и есть имя агента.

Будем поддерживать два формата конфигурации агентов:
* .php
* .jsonc

__Приоритет__ Если рядом находятся два файла с одним имененм, но с разными расширениями, то `.php` в приоритете!

Пример конфигурации на php приведен в файле `agents/neuron1.php` в папке приложения. Он не окончательный. Надо проанализировать возможности neuron-ai и дополнить и оптимизировать.

Второй формат - jsonc. Структуру этого конфигурационного файла надо составить на основе конфигурации в файле php. Требуется сформировать файл примера настроек и разместить его в `agents/neuron1.jsonc`

В `src/classes/config/ConfigurationAgent.php` создать статичный метод `makeFromArray(array $cfg): ?ConfigurationAgent` - это метод на основании массива с настройками должен сформировать экземпляр класса `ConfigurationAgent`.

В `src/classes/config/ConfigurationAgent.php` создать статичный метод `makeFromFile(string $filename): ?ConfigurationAgent` - это метод на основании содержимого должен сформировать экземпляр класса `ConfigurationAgent`.

В папке `src/classes/producers` создать класс `AgentProducer` - он будет по имени агента возвращать экземпляр объекта его конфигурации. В конструктор передаем путь к папке с файлами агентов. Метод `get(string $name): ?ConfigurationAgent` должен вернуть объект конфигурации агента или null. Метод `exist(string $name): bool` должен подтвердить существование агента.

В `AgentProducer` все запрашиваемые агенты должны сохраняться в внутреннем кеше. Если запрашиваемый агент есть в кеше, то возвращаем его из кеша.

Код должен быть полностью комментирован. У каждого класса должен быть заголовок, описывающий его предназначение. Каждый метод должен иметь заголовок, описание функционала и параметры в виде phpdoc!

## Сессии агента (история сообщений)

Контекст агента (история сообщений) будем хранить в файле.

В рабочей директории программы будет поддиректория `.sessions/`

Правило формирования имени (ключ) истории сообщений:

```php
$microtime = microtime(true);
$dt = DateTime::createFromFormat('U.u', sprintf('%.6f', $microtime));
$sessId = $dt->format('Ymd-His-u') . '-' . $agentName;

```
`$agentName` - это имя агента к которому относится сессия.

В `src/classes/config/ConfigurationAgent.php` есть метод `getChatHistory` и свойство `enableChatHistory`. При `enableChatHistory == true` требуется использовать `vendor/neuron-core/neuron-ai/src/Chat/History/FileChatHistory.php`. Если история чата отключена, т.е. `enableChatHistory == false` - используем для истории `vendor/neuron-core/neuron-ai/src/Chat/History/InMemoryChatHistory.php`. И при `enableChatHistory == false` при каждом получении агента через AgentProducer::get будем историю сообщений очищать.

Созданный объект истории сообщений мы сохраняем в приватном свойстве внутри ConfigurationAgent и повторно не создаем.

Код должен быть полностью комментирован. У каждого класса должен быть заголовок, описывающий его предназначение. Каждый метод должен иметь заголовок, описание функционала и параметры в виде phpdoc!